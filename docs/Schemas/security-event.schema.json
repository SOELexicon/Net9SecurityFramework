{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://securityframework.dev/schemas/security-event.schema.json",
  "title": "SecurityFramework Security Event",
  "description": "JSON schema for security events generated by SecurityFramework",
  "type": "object",
  "required": ["eventId", "eventType", "timestamp", "source"],
  "additionalProperties": false,
  "properties": {
    "eventId": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for the security event"
    },
    "eventType": {
      "type": "string",
      "enum": [
        "ThreatDetected",
        "IPBlocked",
        "IPUnblocked", 
        "ParameterJackingDetected",
        "PatternMatched",
        "RateLimitExceeded",
        "SequentialAccessDetected",
        "AnomalousActivity",
        "SecurityIncident",
        "ConfigurationChange",
        "SystemAlert",
        "PerformanceAlert"
      ],
      "description": "Type of security event"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Event timestamp in ISO 8601 format"
    },
    "source": {
      "type": "object",
      "required": ["component"],
      "additionalProperties": false,
      "properties": {
        "component": {
          "type": "string",
          "enum": [
            "IPSecurityMiddleware",
            "ParameterSecurityMiddleware", 
            "RateLimitingMiddleware",
            "PatternMatcher",
            "ScoringEngine",
            "ThreatDetector",
            "SecurityService",
            "BackgroundService",
            "AdminAPI"
          ],
          "description": "SecurityFramework component that generated the event"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Component version"
        },
        "instanceId": {
          "type": "string",
          "description": "Application instance identifier"
        },
        "hostname": {
          "type": "string",
          "description": "Server hostname"
        }
      }
    },
    "severity": {
      "type": "string",
      "enum": ["info", "warning", "error", "critical"],
      "description": "Event severity level"
    },
    "data": {
      "type": "object",
      "description": "Event-specific data payload",
      "oneOf": [
        {"$ref": "#/definitions/threatDetectedData"},
        {"$ref": "#/definitions/ipBlockedData"},
        {"$ref": "#/definitions/parameterJackingData"},
        {"$ref": "#/definitions/patternMatchedData"},
        {"$ref": "#/definitions/rateLimitData"},
        {"$ref": "#/definitions/sequentialAccessData"},
        {"$ref": "#/definitions/anomalousActivityData"},
        {"$ref": "#/definitions/securityIncidentData"},
        {"$ref": "#/definitions/configurationChangeData"},
        {"$ref": "#/definitions/systemAlertData"},
        {"$ref": "#/definitions/performanceAlertData"}
      ]
    },
    "context": {
      "type": "object",
      "additionalProperties": false,
      "description": "Additional context information",
      "properties": {
        "requestId": {
          "type": "string",
          "description": "Request correlation ID"
        },
        "sessionId": {
          "type": "string",
          "description": "User session ID"
        },
        "userId": {
          "type": "string",
          "description": "User identifier"
        },
        "userAgent": {
          "type": "string",
          "maxLength": 1000,
          "description": "User agent string"
        },
        "referrer": {
          "type": "string",
          "format": "uri",
          "description": "HTTP referrer"
        },
        "clientIP": {
          "type": "string",
          "pattern": "^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$|^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$",
          "description": "Client IP address"
        },
        "geolocation": {
          "$ref": "#/definitions/geolocation"
        },
        "request": {
          "$ref": "#/definitions/requestContext"
        },
        "response": {
          "$ref": "#/definitions/responseContext"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "additionalProperties": true
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "maxLength": 50
      },
      "uniqueItems": true,
      "maxItems": 20,
      "description": "Event tags for categorization and filtering"
    }
  },
  "definitions": {
    "threatDetectedData": {
      "type": "object",
      "required": ["threatLevel", "threatScore"],
      "additionalProperties": false,
      "properties": {
        "threatLevel": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "threatScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "trustScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "actionTaken": {
          "type": "string",
          "enum": ["allow", "monitor", "challenge", "restrict", "block"]
        },
        "description": {
          "type": "string",
          "maxLength": 1000
        },
        "patternMatches": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/patternMatch"
          }
        },
        "riskFactors": {
          "type": "array",
          "items": {
            "type": "string",
            "maxLength": 200
          }
        },
        "scoreBreakdown": {
          "$ref": "#/definitions/scoreBreakdown"
        }
      }
    },
    "ipBlockedData": {
      "type": "object",
      "required": ["ipAddress", "reason"],
      "additionalProperties": false,
      "properties": {
        "ipAddress": {
          "type": "string",
          "pattern": "^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$|^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$"
        },
        "reason": {
          "type": "string",
          "maxLength": 500
        },
        "blockedUntil": {
          "type": "string",
          "format": "date-time",
          "description": "Block expiration time (null for permanent blocks)"
        },
        "blockSource": {
          "type": "string",
          "enum": ["automatic", "manual", "external", "pattern", "rateLimit"]
        },
        "threatScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "previousIncidents": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "parameterJackingData": {
      "type": "object",
      "required": ["parameterName", "attemptedValue", "jackingType"],
      "additionalProperties": false,
      "properties": {
        "parameterName": {
          "type": "string",
          "maxLength": 100
        },
        "attemptedValue": {
          "type": "string",
          "maxLength": 1000
        },
        "expectedValue": {
          "type": "string",
          "maxLength": 1000
        },
        "jackingType": {
          "type": "string",
          "enum": [
            "idManipulation",
            "pathTraversal", 
            "privilegeEscalation",
            "sequentialProbing",
            "randomProbing",
            "patternProbing"
          ]
        },
        "riskScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "blocked": {
          "type": "boolean"
        },
        "userId": {
          "type": "string"
        },
        "authorizedResource": {
          "type": "string"
        },
        "attemptedResource": {
          "type": "string"
        }
      }
    },
    "patternMatchedData": {
      "type": "object",
      "required": ["patternId", "patternName", "matchedValue"],
      "additionalProperties": false,
      "properties": {
        "patternId": {
          "type": "string",
          "format": "uuid"
        },
        "patternName": {
          "type": "string",
          "maxLength": 100
        },
        "patternCategory": {
          "type": "string",
          "maxLength": 50
        },
        "matchedValue": {
          "type": "string",
          "maxLength": 10000
        },
        "threatMultiplier": {
          "type": "number",
          "minimum": 0.1,
          "maximum": 100
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "matchType": {
          "type": "string",
          "enum": ["exact", "partial", "regex", "wildcard", "contains"]
        },
        "matchLocation": {
          "type": "string",
          "enum": ["url", "queryParam", "header", "body", "userAgent", "referrer"]
        }
      }
    },
    "rateLimitData": {
      "type": "object",
      "required": ["requestCount", "limit", "windowSize"],
      "additionalProperties": false,
      "properties": {
        "requestCount": {
          "type": "integer",
          "minimum": 0
        },
        "limit": {
          "type": "integer",
          "minimum": 1
        },
        "windowSize": {
          "type": "string",
          "pattern": "^\\d{1,2}:\\d{2}:\\d{2}$"
        },
        "windowStart": {
          "type": "string",
          "format": "date-time"
        },
        "retryAfter": {
          "type": "integer",
          "minimum": 0,
          "description": "Seconds until requests are allowed again"
        },
        "limitType": {
          "type": "string",
          "enum": ["global", "perIP", "perUser", "perEndpoint"]
        }
      }
    },
    "sequentialAccessData": {
      "type": "object",
      "required": ["parameterName", "sequenceLength", "timeWindow"],
      "additionalProperties": false,
      "properties": {
        "parameterName": {
          "type": "string",
          "maxLength": 100
        },
        "sequenceLength": {
          "type": "integer",
          "minimum": 2
        },
        "timeWindow": {
          "type": "string",
          "pattern": "^\\d{1,2}:\\d{2}:\\d{2}$"
        },
        "startValue": {
          "type": "string"
        },
        "endValue": {
          "type": "string"
        },
        "increment": {
          "type": "number"
        },
        "isNumeric": {
          "type": "boolean"
        },
        "pattern": {
          "type": "string",
          "enum": ["ascending", "descending", "random", "complex"]
        }
      }
    },
    "anomalousActivityData": {
      "type": "object",
      "required": ["anomalyType", "anomalyScore"],
      "additionalProperties": false,
      "properties": {
        "anomalyType": {
          "type": "string",
          "enum": [
            "frequencyAnomaly",
            "timingAnomaly", 
            "behaviorAnomaly",
            "geographicAnomaly",
            "userAgentAnomaly",
            "requestPatternAnomaly"
          ]
        },
        "anomalyScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "baselineValue": {
          "type": "number"
        },
        "observedValue": {
          "type": "number"
        },
        "deviation": {
          "type": "number"
        },
        "timeWindow": {
          "type": "string"
        },
        "description": {
          "type": "string",
          "maxLength": 500
        }
      }
    },
    "securityIncidentData": {
      "type": "object",
      "required": ["incidentType", "severity"],
      "additionalProperties": false,
      "properties": {
        "incidentType": {
          "type": "string",
          "enum": [
            "sqlInjection",
            "xss",
            "pathTraversal",
            "parameterJacking",
            "botActivity",
            "bruteForce",
            "dataExfiltration",
            "privilegeEscalation",
            "other"
          ]
        },
        "severity": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "description": {
          "type": "string",
          "maxLength": 1000
        },
        "affectedResources": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "attackVector": {
          "type": "string",
          "maxLength": 200
        },
        "resolved": {
          "type": "boolean",
          "default": false
        },
        "resolvedAt": {
          "type": "string",
          "format": "date-time"
        },
        "mitigationActions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "configurationChangeData": {
      "type": "object",
      "required": ["changedBy", "changeType"],
      "additionalProperties": false,
      "properties": {
        "changedBy": {
          "type": "string",
          "maxLength": 100
        },
        "changeType": {
          "type": "string",
          "enum": [
            "patternAdded",
            "patternModified", 
            "patternRemoved",
            "settingChanged",
            "thresholdAdjusted",
            "blocklistUpdated",
            "userPermissionChanged"
          ]
        },
        "component": {
          "type": "string",
          "maxLength": 100
        },
        "setting": {
          "type": "string",
          "maxLength": 200
        },
        "oldValue": {
          "description": "Previous value (can be any type)"
        },
        "newValue": {
          "description": "New value (can be any type)"
        },
        "reason": {
          "type": "string",
          "maxLength": 500
        },
        "approvedBy": {
          "type": "string",
          "maxLength": 100
        }
      }
    },
    "systemAlertData": {
      "type": "object",
      "required": ["alertType", "message"],
      "additionalProperties": false,
      "properties": {
        "alertType": {
          "type": "string",
          "enum": [
            "serviceUnavailable",
            "databaseError",
            "configurationError",
            "integrationFailure",
            "resourceExhaustion",
            "licenseExpiring",
            "updateAvailable"
          ]
        },
        "message": {
          "type": "string",
          "maxLength": 1000
        },
        "component": {
          "type": "string",
          "maxLength": 100
        },
        "errorCode": {
          "type": "string",
          "maxLength": 50
        },
        "recommendation": {
          "type": "string",
          "maxLength": 500
        },
        "automaticResolution": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "performanceAlertData": {
      "type": "object",
      "required": ["metric", "threshold", "actualValue"],
      "additionalProperties": false,
      "properties": {
        "metric": {
          "type": "string",
          "enum": [
            "responseTime",
            "memoryUsage",
            "cpuUsage",
            "diskUsage",
            "databaseConnections",
            "patternMatchTime",
            "requestRate",
            "errorRate"
          ]
        },
        "threshold": {
          "type": "number"
        },
        "actualValue": {
          "type": "number"
        },
        "unit": {
          "type": "string",
          "maxLength": 20
        },
        "timeWindow": {
          "type": "string",
          "pattern": "^\\d{1,2}:\\d{2}:\\d{2}$"
        },
        "trend": {
          "type": "string",
          "enum": ["increasing", "decreasing", "stable", "volatile"]
        }
      }
    },
    "patternMatch": {
      "type": "object",
      "required": ["patternId", "patternName", "matchedValue"],
      "additionalProperties": false,
      "properties": {
        "patternId": {
          "type": "string",
          "format": "uuid"
        },
        "patternName": {
          "type": "string",
          "maxLength": 100
        },
        "category": {
          "type": "string",
          "maxLength": 50
        },
        "matchedValue": {
          "type": "string",
          "maxLength": 1000
        },
        "threatMultiplier": {
          "type": "number",
          "minimum": 0.1,
          "maximum": 100
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "scoreBreakdown": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "baseScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "patternScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "behaviorScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "frequencyScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "geoScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "timeScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "reputationScore": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "geolocation": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "country": {
          "type": "string",
          "pattern": "^[A-Z]{2}$"
        },
        "countryName": {
          "type": "string",
          "maxLength": 100
        },
        "region": {
          "type": "string",
          "maxLength": 100
        },
        "city": {
          "type": "string",
          "maxLength": 100
        },
        "latitude": {
          "type": "number",
          "minimum": -90,
          "maximum": 90
        },
        "longitude": {
          "type": "number",
          "minimum": -180,
          "maximum": 180
        },
        "timezone": {
          "type": "string",
          "maxLength": 50
        },
        "isp": {
          "type": "string",
          "maxLength": 200
        },
        "isProxy": {
          "type": "boolean"
        },
        "isTor": {
          "type": "boolean"
        },
        "isHosting": {
          "type": "boolean"
        }
      }
    },
    "requestContext": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "DELETE", "PATCH", "HEAD", "OPTIONS", "TRACE"]
        },
        "url": {
          "type": "string",
          "format": "uri",
          "maxLength": 2000
        },
        "path": {
          "type": "string",
          "maxLength": 1000
        },
        "queryString": {
          "type": "string",
          "maxLength": 2000
        },
        "headers": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9\\-_]+$": {"type": "string"}
          }
        },
        "contentType": {
          "type": "string",
          "maxLength": 100
        },
        "contentLength": {
          "type": "integer",
          "minimum": 0
        },
        "protocol": {
          "type": "string",
          "enum": ["HTTP/1.0", "HTTP/1.1", "HTTP/2", "HTTP/3"]
        },
        "isEncrypted": {
          "type": "boolean"
        }
      }
    },
    "responseContext": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "statusCode": {
          "type": "integer",
          "minimum": 100,
          "maximum": 599
        },
        "contentType": {
          "type": "string",
          "maxLength": 100
        },
        "contentLength": {
          "type": "integer",
          "minimum": 0
        },
        "responseTime": {
          "type": "number",
          "minimum": 0,
          "description": "Response time in milliseconds"
        },
        "headers": {
          "type": "object",
          "patternProperties": {
            "^[a-zA-Z0-9\\-_]+$": {"type": "string"}
          }
        }
      }
    }
  },
  "examples": [
    {
      "eventId": "123e4567-e89b-12d3-a456-426614174000",
      "eventType": "ThreatDetected",
      "timestamp": "2024-01-15T10:30:00.000Z",
      "source": {
        "component": "PatternMatcher",
        "version": "1.0.0",
        "instanceId": "web-01",
        "hostname": "security-server-01"
      },
      "severity": "error",
      "data": {
        "threatLevel": "high",
        "threatScore": 85,
        "trustScore": 15,
        "actionTaken": "block",
        "description": "SQL injection attempt detected",
        "patternMatches": [
          {
            "patternId": "550e8400-e29b-41d4-a716-446655440000",
            "patternName": "SQL Injection Basic",
            "category": "SQLInjection",
            "matchedValue": "' UNION SELECT password FROM users--",
            "threatMultiplier": 80,
            "confidence": 0.95
          }
        ],
        "riskFactors": ["SQL injection pattern", "High threat score", "Previous incidents"]
      },
      "context": {
        "requestId": "req-123456",
        "clientIP": "192.168.1.100",
        "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
        "request": {
          "method": "POST",
          "path": "/api/users/search",
          "contentType": "application/json"
        },
        "response": {
          "statusCode": 403,
          "responseTime": 1.2
        }
      },
      "tags": ["sql-injection", "high-risk", "blocked"]
    }
  ]
}